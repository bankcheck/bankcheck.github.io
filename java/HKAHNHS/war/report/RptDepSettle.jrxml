<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="RptDepSettle" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="525" leftMargin="35" rightMargin="35" topMargin="71" bottomMargin="71">
	<property name="ireport.zoom" value="1.5"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="EndDate" class="java.lang.String"/>
	<parameter name="StartDate" class="java.lang.String" isForPrompting="false"/>
	<queryString>
		<![CDATA[SELECT  sc.stename,decode(dp.dpssts,'T','Transferred','R','Refund','N','Receipt','A','Receipt','Forfeit') as dpssts,
                 st.glccode, dp.slpno_s, sp.patno,
                 decode(sp.slpfname,null,pt.patfname||' '||pt.patgname,sp.slpfname||' '||sp.slpgname) as patname,
                 st.stndesc,
                 dp.dpsamt,to_char(dp.dpslcdate,'dd/mm/yyyy') dpslcdate,
                st.stnid

        FROM deposit dp, sliptx st, slip sp, patient pt, site sc

        WHERE
                    dp.dpslcdate BETWEEN to_date('01/01/2006', 'DD/MM/YYYY') and to_date('01/01/2007', 'DD/MM/YYYY')+1
                    and
                    dp.dpssts IN ('T', 'R', 'W', 'N', 'A')and
                    dp.dpsid = st.stnxref and
                    st.stntype = 'X' and
                    st.slpno = sp.slpno and
                    sp.patno= pt.patno(+)
                    and  sp.stecode= 'HKAH' and
                    sp.stecode= sc.stecode
union
        SELECT  sc.stename,'Receipt' as dpssts,
                st.glccode, dp.slpno_s, sp.patno,
                decode(sp.slpfname,null,pt.patfname||' '||pt.patgname,sp.slpfname||' '||sp.slpgname) as patname,
                st.stndesc ,
                dp.dpsamt,to_char(dp.dpslcdate,'dd/mm/yyyy') dpslcdate,st.stnid
                From
                deposit dp, sliptx st, slip sp, patient pt, site sc
                Where dp.DPSCDATE between to_date('01/01/2006', 'DD/MM/YYYY') and to_date('01/01/2007', 'DD/MM/YYYY')+1
                AND dp.dpssts IN ('T', 'R', 'W')
                AND dp.dpsid = st.stnxref
                AND  st.stntype = 'X'
                AND st.slpno = sp.slpno
                AND sp.patno= pt.patno(+)
                and  sp.stecode= 'HKAH'
                AND sp.stecode= sc.stecode]]>
	</queryString>
	<field name="STENAME" class="java.lang.String"/>
	<field name="DPSSTS" class="java.lang.String"/>
	<field name="GLCCODE" class="java.lang.String"/>
	<field name="SLPNO_S" class="java.lang.String"/>
	<field name="PATNO" class="java.lang.String"/>
	<field name="PATNAME" class="java.lang.String"/>
	<field name="STNDESC" class="java.lang.String"/>
	<field name="DPSAMT" class="java.lang.String"/>
	<field name="DPSLCDATE" class="java.lang.String"/>
	<field name="STNID" class="java.math.BigDecimal"/>
	<sortField name="DPSSTS"/>
	<variable name="DPSAMT_1" class="java.lang.Double" resetType="Group" resetGroup="GLCCODE" calculation="Sum">
		<variableExpression><![CDATA[Double.parseDouble($F{DPSAMT})]]></variableExpression>
	</variable>
	<variable name="DPSAMT_2" class="java.lang.Double" resetType="Group" resetGroup="DPSSTS" calculation="Sum">
		<variableExpression><![CDATA[Double.parseDouble($F{DPSAMT})]]></variableExpression>
	</variable>
	<filterExpression><![CDATA[$F{SLPNO_S}.length()>0]]></filterExpression>
	<group name="DPSSTS">
		<groupExpression><![CDATA[$F{DPSSTS}]]></groupExpression>
		<groupHeader>
			<band height="12">
				<textField isStretchWithOverflow="true" isBlankWhenNull="true">
					<reportElement x="1" y="0" width="260" height="12"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{DPSSTS}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="11">
				<textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="true">
					<reportElement x="358" y="0" width="106" height="11"/>
					<box>
						<topPen lineWidth="0.75"/>
					</box>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font fontName="Arial Unicode MS" size="8" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.Double"><![CDATA[$V{DPSAMT_2}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<group name="GLCCODE">
		<groupExpression><![CDATA[$F{GLCCODE}]]></groupExpression>
		<groupHeader>
			<band height="11">
				<textField isStretchWithOverflow="true" isBlankWhenNull="true">
					<reportElement x="1" y="0" width="260" height="11"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Arial Unicode MS" size="6" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{GLCCODE}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="11">
				<textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="true">
					<reportElement x="391" y="0" width="73" height="11"/>
					<box>
						<topPen lineWidth="0.75"/>
					</box>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font fontName="Arial Unicode MS" size="8" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.Double"><![CDATA[$V{DPSAMT_1}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="88" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="391" y="0" width="80" height="11"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" evaluationTime="Report" isBlankWhenNull="true">
				<reportElement x="471" y="0" width="35" height="11"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="1" y="41" width="524" height="12"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Deposit Transaction List]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="76" width="25" height="12"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="7" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Slip No]]></text>
			</staticText>
			<staticText>
				<reportElement x="64" y="76" width="30" height="12"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="7" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Patient]]></text>
			</staticText>
			<staticText>
				<reportElement x="224" y="76" width="52" height="12"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="7" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Description]]></text>
			</staticText>
			<staticText>
				<reportElement x="437" y="76" width="30" height="12"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="7" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Amount]]></text>
			</staticText>
			<staticText>
				<reportElement x="476" y="76" width="35" height="12"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="7" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Capt. Date]]></text>
			</staticText>
			<textField isBlankWhenNull="true">
				<reportElement x="1" y="30" width="524" height="12"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{STENAME}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="0" width="100" height="11"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<text><![CDATA[rptDepSettle]]></text>
			</staticText>
			<textField>
				<reportElement x="1" y="52" width="524" height="12"/>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font fontName="Arial Unicode MS" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{StartDate} + " to " +$P{EndDate}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="HH:mm:ss">
				<reportElement x="80" y="11" width="100" height="11"/>
				<textElement textAlignment="Left">
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy HH.mm.ss">
				<reportElement x="1" y="11" width="79" height="11"/>
				<textElement>
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[(new java.text.SimpleDateFormat(     "dd/MMM/yyyy",Locale.ENGLISH)).format(new java.util.Date())]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<detail>
		<band height="9" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="64" y="0" width="30" height="9"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{PATNO}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="224" y="0" width="167" height="9"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{STNDESC}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#,##0.00;-#,##0.00" isBlankWhenNull="true">
				<reportElement x="422" y="0" width="45" height="9"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.Double"><![CDATA[Double.parseDouble($F{DPSAMT})]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="476" y="0" width="35" height="9"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{DPSLCDATE}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="1" y="0" width="57" height="9"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{SLPNO_S}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="100" y="0" width="124" height="9"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="6"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{PATNAME}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
