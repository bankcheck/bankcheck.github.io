<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="RptDocTreatmentSmy" language="groovy" pageWidth="595" pageHeight="842" whenNoDataType="NoDataSection" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="daterange" class="java.lang.String"/>
	<parameter name="stename" class="java.lang.String"/>
	<queryString>
		<![CDATA[select
         doccode,docfname,docgname,patno,patfname, patgname,floor((sysdate-patbdate)/365) age,to_char(dhsdate,'yyyymmdd') dhsdate,to_char(dhsedate,'yyyymmdd') dhsedate, decode(floor(dhsedate-dhsdate),0,1,floor(dhsedate-dhsdate)) length,sum(stnnamt) as TotalCharges
      From
         ( select
                d.docfname docfname,d.docgname docgname, dh.DocCode doccode,dh.dhsdate dhsdate,dh.dhsedate dhsedate, dh.PatNo patno,p.patfname patfname, p.patgname patgname,p.patbdate patbdate , st.stnnamt stnnamt
             From
                 dochist dh,slip s,sliptx st , patient p,doctor d
             Where
                dh.patno = s.patno
                 and dh.regid = s.regid
                 and s.slpno = st.slpno
                and decode(sign(dh.dhsdate-to_date('01/02/2006', 'DD/MM/YYYY'))+
                sign(to_date('01/01/2006', 'DD/MM/YYYY')-1-dh.dhsedate ),-2,1,0)=1
                 AND dh.dhsedate IS NOT NULL
                 AND decode(st.stntype,'S',0,'P',0,'R',0,1)=1
                 and dh.doccode = st.doccode
                 and dh.doccode= d.doccode
                 and dh.patno = p.patno
                 and s.stecode='HKAH')
Group By doccode,docfname,docgname,patno,patfname, patgname,patbdate,dhsdate,dhsedate
order by doccode,docfname,docgname]]>
	</queryString>
	<field name="DOCCODE" class="java.lang.String"/>
	<field name="DOCFNAME" class="java.lang.String"/>
	<field name="DOCGNAME" class="java.lang.String"/>
	<field name="PATNO" class="java.lang.String"/>
	<field name="PATFNAME" class="java.lang.String"/>
	<field name="PATGNAME" class="java.lang.String"/>
	<field name="AGE" class="java.math.BigDecimal"/>
	<field name="DHSDATE" class="java.lang.String"/>
	<field name="DHSEDATE" class="java.lang.String"/>
	<field name="LENGTH" class="java.math.BigDecimal"/>
	<field name="TOTALCHARGES" class="java.math.BigDecimal"/>
	<variable name="patname" class="java.lang.String">
		<variableExpression><![CDATA[$F{PATFNAME}+" "+$F{PATGNAME}]]></variableExpression>
	</variable>
	<variable name="docname" class="java.lang.String">
		<variableExpression><![CDATA[$F{DOCCODE}+" "+$F{DOCFNAME}+" "+$F{DOCGNAME}]]></variableExpression>
	</variable>
	<group name="group_doctor">
		<groupExpression><![CDATA[$F{DOCCODE}+$F{DOCFNAME}+$F{DOCGNAME}]]></groupExpression>
		<groupHeader>
			<band height="21">
				<printWhenExpression><![CDATA[$F{DOCCODE}.length()>0]]></printWhenExpression>
				<textField>
					<reportElement x="16" y="1" width="47" height="20"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Arial Unicode MS" isUnderline="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{DOCCODE}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="true">
					<reportElement x="72" y="1" width="130" height="20"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Arial Unicode MS" isUnderline="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{DOCFNAME}+" "+$F{DOCGNAME}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="141" splitType="Stretch">
			<textField>
				<reportElement x="434" y="2" width="80" height="20"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="49" width="555" height="19"/>
				<textElement textAlignment="Center" verticalAlignment="Top">
					<font fontName="Arial Unicode MS" size="11" isBold="true"/>
				</textElement>
				<text><![CDATA[Cashier Audit Report]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="2" width="100" height="14"/>
				<textElement>
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<text><![CDATA[rptCshrAudit]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy HH.mm.ss">
				<reportElement x="0" y="16" width="194" height="14"/>
				<textElement>
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="67" width="554" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{daterange}]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="514" y="2" width="40" height="20"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="1" y="30" width="554" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font fontName="Arial Unicode MS" size="11" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{stename}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="16" y="106" width="47" height="35"/>
				<textElement>
					<font fontName="Arial Unicode MS" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Patient No.]]></text>
			</staticText>
			<staticText>
				<reportElement x="72" y="106" width="130" height="35"/>
				<textElement>
					<font fontName="Arial Unicode MS" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Patient Name]]></text>
			</staticText>
			<staticText>
				<reportElement x="214" y="106" width="31" height="35"/>
				<textElement textAlignment="Center">
					<font fontName="Arial Unicode MS" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Age]]></text>
			</staticText>
			<staticText>
				<reportElement x="338" y="106" width="58" height="35"/>
				<textElement>
					<font fontName="Arial Unicode MS" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Treatment End]]></text>
			</staticText>
			<staticText>
				<reportElement x="476" y="106" width="67" height="35"/>
				<textElement textAlignment="Right">
					<font fontName="Arial Unicode MS" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Total Charges]]></text>
			</staticText>
			<staticText>
				<reportElement x="410" y="106" width="54" height="35"/>
				<textElement textAlignment="Right">
					<font fontName="Arial Unicode MS" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Length of
 Stay]]></text>
			</staticText>
			<staticText>
				<reportElement x="260" y="106" width="62" height="35"/>
				<textElement>
					<font fontName="Arial Unicode MS" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Treatment Begin]]></text>
			</staticText>
		</band>
	</pageHeader>
	<detail>
		<band height="14" splitType="Stretch">
			<printWhenExpression><![CDATA[$F{DOCCODE}.length()>0]]></printWhenExpression>
			<textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="false">
				<reportElement x="476" y="0" width="67" height="14"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{TOTALCHARGES}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement x="260" y="0" width="62" height="14"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{DHSDATE}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement x="15" y="0" width="48" height="14"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{PATNO}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="false">
				<reportElement x="72" y="0" width="130" height="14"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$V{patname}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0;-#,##0" isBlankWhenNull="false">
				<reportElement x="214" y="0" width="31" height="14"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{AGE}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0;-#,##0" isBlankWhenNull="false">
				<reportElement x="410" y="0" width="54" height="14"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{LENGTH}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="false">
				<reportElement x="338" y="0" width="58" height="14"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{DHSEDATE}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
