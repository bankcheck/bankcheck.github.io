<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="RptOutstdBal" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="539" leftMargin="28" rightMargin="28" topMargin="56" bottomMargin="56">
	<property name="ireport.zoom" value="1.5"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="siteName" class="java.lang.String"/>
	<queryString>
		<![CDATA[Select
                S.Patno, decode(S.patno, null, S.Slpfname || ' ' || S.Slpgname, P.Patfname || ' ' || P.patgname) as Patname,
                S.Slpno, decode(S.Slptype,'O','Out Patient','I','In Patient','Day Case') Slptype, Pc.Pcydesc, to_char(R.Regdate,'dd/mm/yyyy') Regdate, (S.Slpcamt + S.Slpdamt + S.Slppamt- nvl(st.netamt,0)) as SlpAmt, S.SlpRemark
                From Slip S, Reg R, Patcat Pc, Patient P, (
                select st.slpno, SUM(stnnamt) as netamt , 'N'
                 From sliptx st
                 Where
                 (stncdate is null or stncdate >= to_date('01/01/2009','DD/MM/YYYY') + 1)
                 and stnsts in ('N','A')
                 group by st.slpno
                 having sum(stnnamt) <> 0) st
                Where
                S.stecode= 'HKAH' and
                s.slpno = st.slpno (+) and
                S.Pcyid = Pc.pcyid (+) and
                p.patno (+)  = S.Patno  and
                s.slptype <> 'O' and r.regtype <> 'O' and
                s.regid = r.regid (+) and
                not ((s.slpsts = 'C' or s.slpsts = 'R') and (slppamt+slpdamt+slpcamt - nvl(st.netamt,0)) = 0)
                Union All
                select
                S.Patno, decode(S.patno, null, S.Slpfname || ' ' || S.Slpgname, P.Patfname || ' ' || P.patgname) as Patname,
                S.Slpno,decode(S.Slptype,'O','Out Patient','I','In Patient','Day Case') Slptype, Pc.Pcydesc, to_char(R.Regdate,'dd/mm/yyyy') Regdate, (S.Slpcamt + S.Slpdamt + S.Slppamt- nvl(st.netamt,0)) as SlpAmt, S.SlpRemark
                From  slip s, (
                select st.slpno, SUM(stnnamt) as netamt , 'N'
                 From sliptx st
                 Where
                 (stncdate is null or stncdate >= to_date('01/01/2009','DD/MM/YYYY') + 1)
                 and stnsts in ('N','A')
                 group by st.slpno
                 having sum(stnnamt) <> 0) st, reg r, patient p, patcat pc
                Where
                S.stecode= 'HKAH' and
                s.slptype = 'O' and s.slpno = st.slpno (+) and
                not ((s.slpsts = 'C' or s.slpsts = 'R') and (slppamt+slpdamt+slpcamt - nvl(st.netamt,0)) = 0) and
                s.slpno = r.slpno (+) and s.patno = p.patno (+) and s.pcyid = pc.pcyid(+)]]>
	</queryString>
	<field name="PATNO" class="java.lang.String"/>
	<field name="PATNAME" class="java.lang.String"/>
	<field name="SLPNO" class="java.lang.String"/>
	<field name="SLPTYPE" class="java.lang.String"/>
	<field name="PCYDESC" class="java.lang.String"/>
	<field name="REGDATE" class="java.lang.String"/>
	<field name="SLPAMT" class="java.lang.String"/>
	<field name="SLPREMARK" class="java.lang.String"/>
	<variable name="SLPAMT_1" class="java.math.BigDecimal" resetType="Column" calculation="Sum">
		<variableExpression><![CDATA[$V{SLPAMT_BD}]]></variableExpression>
	</variable>
	<variable name="SLPAMT_2" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$V{SLPAMT_BD}]]></variableExpression>
	</variable>
	<variable name="SLPAMT_3" class="java.math.BigDecimal" resetType="Group" resetGroup="PATNO" calculation="Sum">
		<variableExpression><![CDATA[$V{SLPAMT_BD}]]></variableExpression>
	</variable>
	<variable name="SLPAMT_BD" class="java.math.BigDecimal" resetType="None">
		<variableExpression><![CDATA[new BigDecimal($F{SLPAMT})]]></variableExpression>
	</variable>
	<variable name="V_PATNO" class="java.lang.String"/>
	<group name="PATNO">
		<groupExpression><![CDATA[$F{PATNO}]]></groupExpression>
		<groupFooter>
			<band height="15">
				<staticText>
					<reportElement x="318" y="0" width="43" height="15"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
					</textElement>
					<text><![CDATA[Sub Total]]></text>
				</staticText>
				<textField evaluationTime="Group" evaluationGroup="PATNO" pattern="#,##0.00;-#,##0.00" isBlankWhenNull="true">
					<reportElement x="361" y="0" width="47" height="15"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font fontName="Arial Unicode MS" size="8" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{SLPAMT_3}]]></textFieldExpression>
				</textField>
			</band>
		</groupFooter>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="94" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="100" height="14"/>
				<textElement>
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<text><![CDATA[rptOutstdBal]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="49" width="539" height="14"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" isBold="true"/>
				</textElement>
				<text><![CDATA[Outstanding Balance Report]]></text>
			</staticText>
			<textField>
				<reportElement x="419" y="0" width="80" height="14"/>
				<textElement textAlignment="Right">
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="499" y="0" width="40" height="14"/>
				<textElement>
					<font fontName="Arial Unicode MS"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="0" y="36" width="539" height="14"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{siteName}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="79" width="51" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Patient No]]></text>
			</staticText>
			<staticText>
				<reportElement x="58" y="79" width="97" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Name]]></text>
			</staticText>
			<staticText>
				<reportElement x="159" y="79" width="56" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Slip No]]></text>
			</staticText>
			<staticText>
				<reportElement x="215" y="79" width="51" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Type]]></text>
			</staticText>
			<staticText>
				<reportElement x="266" y="79" width="47" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Category]]></text>
			</staticText>
			<staticText>
				<reportElement x="413" y="79" width="126" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Remark]]></text>
			</staticText>
			<staticText>
				<reportElement x="318" y="79" width="43" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Reg. Date]]></text>
			</staticText>
			<staticText>
				<reportElement x="361" y="79" width="47" height="15"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Balance  ]]></text>
			</staticText>
			<textField isStretchWithOverflow="true" pattern="HH:mm:ss">
				<reportElement x="79" y="14" width="100" height="14"/>
				<textElement textAlignment="Left">
					<font fontName="Arial Unicode MS" size="10"/>
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy HH.mm.ss">
				<reportElement x="0" y="14" width="79" height="14"/>
				<textElement>
					<font fontName="Arial Unicode MS" size="10"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[(new java.text.SimpleDateFormat(     "dd/MMM/yyyy",Locale.ENGLISH)).format(new java.util.Date())]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<detail>
		<band height="15" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToTallestObject" x="58" y="0" width="101" height="15" isPrintWhenDetailOverflows="true"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{PATNAME}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="159" y="0" width="56" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{SLPNO}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="215" y="0" width="51" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{SLPTYPE}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="266" y="0" width="52" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{PCYDESC}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="318" y="0" width="43" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{REGDATE}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="true">
				<reportElement x="361" y="0" width="47" height="15"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{SLPAMT_BD}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" x="413" y="0" width="126" height="15" isPrintWhenDetailOverflows="true"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Ming(for ISO10646_V3)" size="8" pdfFontName="Ming(for ISO10646_V3)" isPdfEmbedded="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{SLPREMARK}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="0" width="58" height="15">
					<printWhenExpression><![CDATA[!"nopatno".equals($V{V_PATNO})]]></printWhenExpression>
				</reportElement>
				<textElement>
					<font fontName="Arial Unicode MS" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{PATNO}!=null?$F{PATNO}:"nopatno"]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="15" splitType="Stretch">
			<textField pattern="#,##0.00;-#,##0.00" isBlankWhenNull="true">
				<reportElement x="361" y="0" width="47" height="15"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{SLPAMT_2}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="313" y="0" width="48" height="15"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial Unicode MS" size="8" isBold="true" isUnderline="true"/>
				</textElement>
				<text><![CDATA[Grand Total]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
